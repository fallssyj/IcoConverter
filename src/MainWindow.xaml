<hc:Window
    x:Class="IcoConverter.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:IcoConverter.Models"
    xmlns:utils="clr-namespace:IcoConverter.Utils"
    Title="{Binding Title}"
    Width="1200"
    Height="800"
    AllowDrop="True"
    MouseLeftButtonDown="Window_MouseLeftButtonDown"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <hc:Window.NonClientAreaContent>
        <Grid>
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    Width="40"
                    BorderThickness="0"
                    Command="{Binding ChangeThemeCommand}">
                    <Path
                        Margin="1"
                        Data="{StaticResource Brightness6}"
                        Fill="{DynamicResource PrimaryTextBrush}"
                        Stretch="Uniform" />
                </Button>
                <Button
                    Width="40"
                    BorderThickness="0"
                    Command="{Binding OpenGithubCommand}">
                    <Path
                        Margin="1"
                        Data="{StaticResource Github}"
                        Fill="{DynamicResource PrimaryTextBrush}"
                        RenderTransformOrigin="0.5,0.5"
                        Stretch="Uniform">
                        <Path.RenderTransform>
                            <ScaleTransform ScaleY="-1" />
                        </Path.RenderTransform>
                    </Path>
                </Button>
                <Button
                    Width="40"
                    BorderThickness="0"
                    Command="{Binding OpenAboutCommand}">
                    <Path
                        Margin="1"
                        Data="{StaticResource Info}"
                        Fill="{DynamicResource PrimaryTextBrush}"
                        RenderTransformOrigin="0.5,0.5"
                        Stretch="Uniform">
                        <Path.RenderTransform>
                            <ScaleTransform ScaleY="-1" />
                        </Path.RenderTransform>
                    </Path>
                </Button>
            </StackPanel>
        </Grid>

    </hc:Window.NonClientAreaContent>
    <hc:Window.Resources>
        <utils:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <utils:MaskShapeConverter x:Key="MaskShapeConverter" />

    </hc:Window.Resources>
    <Border>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>


            <!--  主内容区域  -->
            <Grid Grid.Row="0" Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="400" />
                </Grid.ColumnDefinitions>


                <!--  左侧：图片预览和编辑  -->
                <Grid Grid.Column="0" Margin="0,0,10,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <!--  图片控制按钮  -->
                    <WrapPanel
                        Grid.Row="0"
                        Margin="0,0,0,5"
                        Orientation="Horizontal">
                        <Button
                            Width="110"
                            Height="40"
                            Command="{Binding LoadImageCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource File}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="加载图片" />
                            </StackPanel>
                        </Button>


                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding ConvertToIcoCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource FileDirectorySymlink}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="导出ICO" />
                            </StackPanel>
                        </Button>
                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding ExportPreviewToPngCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource FileDirectorySymlink}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="导出PNG" />
                            </StackPanel>
                        </Button>
                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding BatchConvertCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource FileDirectorySymlink}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="批量转换" />
                            </StackPanel>
                        </Button>
                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding CancelCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource JournalX}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="取消" />
                            </StackPanel>
                        </Button>

                    </WrapPanel>

                    <!--  图片预览区域  -->
                    <Border
                        Grid.Row="1"
                        Margin="0"
                        Padding="12">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <TextBlock
                                Grid.Row="0"
                                FontSize="16"
                                Text="图片预览" />

                            <Grid Grid.Row="1" Margin="0,10,0,0">
                                <Viewbox Stretch="Uniform">
                                    <Image
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        Source="{Binding PreviewImage}"
                                        Stretch="Uniform" />
                                </Viewbox>

                                <!--  拖放提示  -->
                                <Border
                                    CornerRadius="4"
                                    Opacity="0.25"
                                    Visibility="{Binding IsDropHintVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="24"
                                        Text="拖放文件到这里" />
                                </Border>
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>

                <!--  右侧：设置面板  -->
                <ScrollViewer
                    Grid.Column="1"
                    MinWidth="320"
                    Padding="10"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Visible">
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,6"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="设置" />
                        <Separator Margin="0,0,0,10" />

                        <!--  蒙版设置  -->
                        <Expander
                            Margin="0,0,0,10"
                            Header="蒙版设置"
                            IsExpanded="{Binding IsMaskSettingsExpanded}">
                            <StackPanel Margin="10,5,0,0">
                                <CheckBox
                                    Margin="0,0,0,8"
                                    Content="启用实时预览（大图可关闭提升性能）"
                                    IsChecked="{Binding IsRealTimePreviewEnabled}" />

                                <Grid Margin="0,5,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="60" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="圆角半径:" />
                                    <Slider
                                        x:Name="CornerRadiusSlider"
                                        Grid.Column="1"
                                        Margin="8,0,0,0"
                                        VerticalAlignment="Center"
                                        IsEnabled="{Binding IsCornerRadiusEnabled}"
                                        IsSnapToTickEnabled="True"
                                        Maximum="{Binding CornerRadiusMaximum}"
                                        Minimum="0"
                                        PreviewMouseWheel="CornerRadiusSlider_PreviewMouseWheel"
                                        TickFrequency="4"
                                        Value="{Binding CornerRadius, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBox Grid.Column="2" Margin="3,0">
                                        <TextBox.Text>
                                            <Binding
                                                NotifyOnValidationError="True"
                                                Path="CornerRadius"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnExceptions="True">
                                                <Binding.ValidationRules>
                                                    <utils:IntRangeValidationRule Maximum="100000" Minimum="0" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                    <StackPanel
                                        Grid.Column="3"
                                        Margin="4,0,0,0"
                                        Orientation="Vertical">
                                        <RepeatButton
                                            Width="28"
                                            Height="22"
                                            Margin="0,0,0,4"
                                            Command="{Binding IncreaseCornerRadiusCommand}"
                                            Content="+"
                                            Delay="250"
                                            Interval="80" />
                                        <RepeatButton
                                            Width="28"
                                            Height="22"
                                            Command="{Binding DecreaseCornerRadiusCommand}"
                                            Content="-"
                                            Delay="250"
                                            Interval="80" />
                                    </StackPanel>
                                </Grid>

                                <Grid Margin="0,5,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="目标 DPI:" />
                                    <TextBox Grid.Column="1" Margin="5,0">
                                        <TextBox.Text>
                                            <Binding
                                                NotifyOnValidationError="True"
                                                Path="TargetDpi"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnExceptions="True">
                                                <Binding.ValidationRules>
                                                    <utils:IntRangeValidationRule Maximum="1024" Minimum="0" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>

                                </Grid>
                                <TextBlock
                                    Margin="0,4,0,0"
                                    FontSize="13"
                                    Opacity="0.4"
                                    Text="不确定时保持 96，系统默认 DPI" />

                                <Separator Margin="0,12,0,10" />

                                <TextBlock
                                    Margin="0,0,0,6"
                                    FontWeight="SemiBold"
                                    Text="图片缩放与位置" />

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="70" />
                                        <ColumnDefinition Width="70" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="缩放:" />
                                    <Slider
                                        Grid.Column="1"
                                        Margin="8,0,0,0"
                                        IsSnapToTickEnabled="True"
                                        Maximum="4"
                                        Minimum="0.1"
                                        TickFrequency="0.05"
                                        Value="{Binding ImageScale, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBox Grid.Column="2" Margin="3,0">
                                        <TextBox.Text>
                                            <Binding Path="ImageScale" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <utils:DoubleRangeValidationRule Maximum="4" Minimum="0.1" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                    <TextBlock
                                        Grid.Column="3"
                                        Margin="6,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding ImageScale, StringFormat={}{0:0.00}x}" />
                                </Grid>

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="70" />
                                        <ColumnDefinition Width="70" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="X 偏移:" />
                                    <Slider
                                        Grid.Column="1"
                                        Margin="8,0,0,0"
                                        Maximum="{Binding ImageOffsetMaximum}"
                                        Minimum="{Binding ImageOffsetMinimum}"
                                        TickFrequency="10"
                                        Value="{Binding ImageOffsetX, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBox Grid.Column="2" Margin="3,0">
                                        <TextBox.Text>
                                            <Binding Path="ImageOffsetX" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <utils:DoubleRangeValidationRule />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                    <TextBlock
                                        Grid.Column="3"
                                        Margin="6,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding ImageOffsetX, StringFormat={}{0:0.#}px}" />
                                </Grid>

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="70" />
                                        <ColumnDefinition Width="70" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="Y 偏移:" />
                                    <Slider
                                        Grid.Column="1"
                                        Margin="8,0,0,0"
                                        Maximum="{Binding ImageOffsetMaximum}"
                                        Minimum="{Binding ImageOffsetMinimum}"
                                        TickFrequency="10"
                                        Value="{Binding ImageOffsetY, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBox Grid.Column="2" Margin="3,0">
                                        <TextBox.Text>
                                            <Binding Path="ImageOffsetY" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <utils:DoubleRangeValidationRule />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                    <TextBlock
                                        Grid.Column="3"
                                        Margin="6,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="{Binding ImageOffsetY, StringFormat={}{0:0.#}px}" />
                                </Grid>

                                <StackPanel Margin="0,12,0,0" Orientation="Horizontal">
                                    <Button
                                        Width="90"
                                        Height="30"
                                        Margin="0,0,10,0"
                                        Command="{Binding UndoMaskCommand}"
                                        Content="撤销" />
                                    <Button
                                        Width="90"
                                        Height="30"
                                        Margin="0,0,10,0"
                                        Command="{Binding RedoMaskCommand}"
                                        Content="重做" />
                                    <Button
                                        Width="110"
                                        Height="30"
                                        Command="{Binding ApplyCornerRadiusCommand}"
                                        Content="应用蒙版" />
                                </StackPanel>

                                <TextBlock Margin="0,12,0,0" Text="蒙版形状" />
                                <ComboBox
                                    Margin="0,4,0,0"
                                    ItemsSource="{Binding MaskShapeOptions}"
                                    SelectedItem="{Binding SelectedMaskShape}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource MaskShapeConverter}}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>

                                <StackPanel Margin="0,8,0,0" Visibility="{Binding IsPolygonShapeSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="多边形边数" />
                                    <TextBox Margin="0,4,0,0">
                                        <TextBox.Text>
                                            <Binding
                                                NotifyOnValidationError="True"
                                                Path="PolygonSides"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnExceptions="True">
                                                <Binding.ValidationRules>
                                                    <utils:IntRangeValidationRule Maximum="64" Minimum="3" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                    <TextBlock Margin="0,12,0,0" Text="旋转角度 (°)" />
                                    <Grid Margin="0,4,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Slider
                                            x:Name="PolygonRotationSlider"
                                            Grid.Column="0"
                                            VerticalAlignment="Center"
                                            IsSnapToTickEnabled="True"
                                            Maximum="180"
                                            Minimum="-180"
                                            PreviewMouseWheel="PolygonRotationSlider_PreviewMouseWheel"
                                            TickFrequency="5"
                                            Value="{Binding PolygonRotation, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        <TextBox Grid.Column="1" Margin="5,0,0,0">
                                            <TextBox.Text>
                                                <Binding
                                                    NotifyOnValidationError="True"
                                                    Path="PolygonRotation"
                                                    UpdateSourceTrigger="PropertyChanged"
                                                    ValidatesOnExceptions="True">
                                                    <Binding.ValidationRules>
                                                        <utils:DoubleRangeValidationRule Maximum="180" Minimum="-180" />
                                                    </Binding.ValidationRules>
                                                </Binding>
                                            </TextBox.Text>
                                        </TextBox>
                                        <StackPanel
                                            Grid.Column="2"
                                            Margin="4,0,0,0"
                                            Orientation="Vertical">
                                            <RepeatButton
                                                Width="28"
                                                Height="22"
                                                Margin="0,0,0,4"
                                                Command="{Binding IncreasePolygonRotationCommand}"
                                                Content="+"
                                                Delay="250"
                                                Interval="80" />
                                            <RepeatButton
                                                Width="28"
                                                Height="22"
                                                Command="{Binding DecreasePolygonRotationCommand}"
                                                Content="-"
                                                Delay="250"
                                                Interval="80" />
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>

                            </StackPanel>
                        </Expander>
                        <Separator Margin="0,0,0,10" />

                        <!--  蒙版记录  -->
                        <Expander Margin="0,0,0,10" Header="蒙版记录">
                            <StackPanel Margin="10,5,0,0">
                                <TextBlock Opacity="0.7" Text="展示最近 20 条蒙版调整与预览记录。" />
                                <ListBox
                                    MaxHeight="150"
                                    Margin="0,8,0,0"
                                    ItemsSource="{Binding MaskHistory}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" TextWrapping="Wrap" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <TextBlock
                                    Margin="0,4,0,0"
                                    Opacity="0.5"
                                    Text="暂无记录"
                                    TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding MaskHistory.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <Button
                                    Width="100"
                                    Height="28"
                                    Margin="0,8,0,0"
                                    HorizontalAlignment="Right"
                                    Command="{Binding ClearMaskHistoryCommand}"
                                    Content="清空记录" />
                            </StackPanel>
                        </Expander>
                        <Separator Margin="0,0,0,10" />

                        <!--  使用提示  -->
                        <Expander
                            Margin="0,5,0,10"
                            Header="使用提示"
                            IsExpanded="False">
                            <StackPanel Margin="10,0,0,0">
                                <TextBlock Text="- 拖放图片或 EXE/DLL 即可提取内置图标。" TextWrapping="Wrap" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    Text="- 关闭实时预览可避免大图频繁渲染，调整完成后点击 &quot;应用蒙版&quot;。"
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    Text="- 使用撤销/重做或鼠标滚轮快速微调蒙版参数。"
                                    TextWrapping="Wrap" />
                                <TextBlock
                                    Margin="0,4,0,0"
                                    Text="- ICO 分辨率建议至少保留 16px、32px、48px、256px 以兼容不同缩放。"
                                    TextWrapping="Wrap" />
                            </StackPanel>
                        </Expander>

                        <Separator Margin="0,0,0,10" />

                        <!--  ICO分辨率设置  -->
                        <Expander
                            Margin="0,0,0,10"
                            Header="ICO分辨率"
                            IsExpanded="{Binding IsIcoResolutionExpanded}">
                            <ListBox
                                MaxHeight="200"
                                ItemsSource="{Binding AvailableResolutions}"
                                ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ItemTemplate>
                                    <DataTemplate DataType="models:IcoResolution">
                                        <CheckBox
                                            Margin="2"
                                            Content="{Binding DisplayText}"
                                            IsChecked="{Binding IsSelected}" />
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Expander>
                        <Separator Margin="0,0,0,10" />
                        <!--  操作按钮  -->
                        <WrapPanel Margin="0,0,0,10" HorizontalAlignment="Center">
                            <Button
                                Width="80"
                                Height="30"
                                Margin="0,0,10,10"
                                Click="SelectAllResolutions_Click"
                                Content="全选" />
                            <Button
                                Width="80"
                                Height="30"
                                Margin="0,0,0,10"
                                Click="ClearAllResolutions_Click"
                                Content="清空" />

                        </WrapPanel>
                    </StackPanel>
                </ScrollViewer>

            </Grid>


            <!--  日志区域  -->
            <Expander
                Grid.Row="1"
                Margin="0,4,0,0"
                ExpandDirection="Up"
                Header="日志"
                IsExpanded="{Binding IsLogExpanded}">
                <Border
                    Grid.Row="1"
                    Height="200"
                    Padding="10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            FontSize="16"
                            Text="操作日志"
                            Visibility="Collapsed" />
                        <Button
                            Grid.Row="0"
                            Height="30"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Command="{Binding ClearLogCommand}"
                            Content="清空日志"
                            Visibility="Collapsed" />
                        <TextBox
                            Grid.Row="0"
                            Padding="10"
                            VerticalContentAlignment="Top"
                            IsReadOnly="True"
                            Text="{Binding LogText}"
                            TextChanged="LogTextBox_TextChanged"
                            VerticalScrollBarVisibility="Auto" />

                    </Grid>
                </Border>

            </Expander>
            <!--  状态栏  -->
            <Border
                Grid.Row="2"
                Margin="0"
                Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <StackPanel
                        Grid.Column="0"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <Path
                            Data="{StaticResource Info16}"
                            Fill="{DynamicResource PrimaryTextBrush}"
                            Stretch="Uniform" />
                        <TextBlock
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            Text="{Binding StatusMessage}" />
                    </StackPanel>

                    <ProgressBar
                        Grid.Column="1"
                        Margin="20,0"
                        IsIndeterminate="{Binding IsProcessing}"
                        Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </Grid>
            </Border>
        </Grid>
    </Border>
</hc:Window>
