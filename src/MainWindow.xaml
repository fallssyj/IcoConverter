<hc:Window
    x:Class="IcoConverter.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:IcoConverter.Models"
    xmlns:utils="clr-namespace:IcoConverter.Utils"
    Title="{Binding Title}"
    Width="1200"
    Height="800"
    AllowDrop="True"
    MouseLeftButtonDown="Window_MouseLeftButtonDown"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <hc:Window.NonClientAreaContent>
        <Grid>
            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                <Button
                    Width="40"
                    BorderThickness="0"
                    Command="{Binding ChangeThemeCommand}">
                    <Path
                        Margin="1"
                        Data="{StaticResource Brightness6}"
                        Fill="{DynamicResource PrimaryTextBrush}"
                        Stretch="Uniform" />
                </Button>
                <Button
                    Width="40"
                    BorderThickness="0"
                    Command="{Binding OpenGithubCommand}">
                    <Path
                        Margin="1"
                        Data="{StaticResource Github}"
                        Fill="{DynamicResource PrimaryTextBrush}"
                        RenderTransformOrigin="0.5,0.5"
                        Stretch="Uniform">
                        <Path.RenderTransform>
                            <ScaleTransform ScaleY="-1" />
                        </Path.RenderTransform>
                    </Path>
                </Button>
                <Button
                    Width="40"
                    BorderThickness="0"
                    Command="{Binding OpenAboutCommand}">
                    <Path
                        Margin="1"
                        Data="{StaticResource Info}"
                        Fill="{DynamicResource PrimaryTextBrush}"
                        RenderTransformOrigin="0.5,0.5"
                        Stretch="Uniform">
                        <Path.RenderTransform>
                            <ScaleTransform ScaleY="-1" />
                        </Path.RenderTransform>
                    </Path>
                </Button>
            </StackPanel>
        </Grid>

    </hc:Window.NonClientAreaContent>
    <hc:Window.Resources>
        <!--  转换器  -->
        <utils:CornerQualityConverter x:Key="CornerQualityConverter" />
        <utils:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

    </hc:Window.Resources>
    <Border>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="200" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>


            <!--  主内容区域  -->
            <Grid Grid.Row="0" Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>


                <!--  左侧：图片预览和编辑  -->
                <Grid Grid.Column="0" Margin="0,0,10,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>

                    <!--  图片控制按钮  -->
                    <WrapPanel
                        Grid.Row="0"
                        Margin="0,0,0,5"
                        Orientation="Horizontal">
                        <Button
                            Width="110"
                            Height="40"
                            Command="{Binding LoadImageCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource File}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="加载图片" />
                            </StackPanel>
                        </Button>

                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding ApplyCornerRadiusCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource JournalCheck}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="应用圆角" />
                            </StackPanel>
                        </Button>

                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding ConvertToIcoCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource FileDirectorySymlink}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="导出ICO" />
                            </StackPanel>
                        </Button>
                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding ExportPreviewToPngCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource FileDirectorySymlink}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="导出PNG" />
                            </StackPanel>
                        </Button>
                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding BatchConvertCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource FileDirectorySymlink}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="批量转换" />
                            </StackPanel>
                        </Button>
                        <Button
                            Width="110"
                            Height="40"
                            Margin="5,0,0,0"
                            Command="{Binding CancelCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path
                                    Width="20"
                                    Height="20"
                                    Data="{StaticResource JournalX}"
                                    Fill="{DynamicResource PrimaryTextBrush}"
                                    Stretch="Uniform" />
                                <TextBlock
                                    Margin="5,0,0,0"
                                    VerticalAlignment="Center"
                                    Text="取消" />
                            </StackPanel>
                        </Button>

                    </WrapPanel>

                    <!--  图片预览区域  -->
                    <Border
                        Grid.Row="1"
                        Margin="0"
                        Padding="12">
                        <StackPanel>
                            <TextBlock
                                DockPanel.Dock="Left"
                                FontSize="16"
                                Text="图片预览" />
                            <Grid>
                                <Image
                                    MaxWidth="600"
                                    MaxHeight="400"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Source="{Binding PreviewImage}"
                                    Stretch="Uniform" />


                                <!--  拖放提示  -->
                                <Border
                                    CornerRadius="4"
                                    Opacity="0.25"
                                    Visibility="{Binding IsDropHintVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        FontSize="24"
                                        Text="拖放图片到这里" />
                                </Border>
                            </Grid>
                        </StackPanel>
                    </Border>
                </Grid>

                <!--  右侧：设置面板  -->
                <ScrollViewer
                    Grid.Column="1"
                    MinWidth="320"
                    HorizontalScrollBarVisibility="Disabled"
                    VerticalScrollBarVisibility="Visible">
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,6"
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="设置" />
                        <Separator Margin="0,0,0,10" />

                        <!--  圆角设置 - 使用Card样式  -->
                        <Border Margin="0,0,0,10" Padding="16">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,10" Text="圆角设置" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Column="0"
                                        VerticalAlignment="Center"
                                        Text="半径:" />
                                    <TextBox Grid.Column="1" Margin="5,0">
                                        <TextBox.Text>
                                            <Binding
                                                NotifyOnValidationError="True"
                                                Path="CornerRadius"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnExceptions="True">
                                                <Binding.ValidationRules>
                                                    <utils:IntRangeValidationRule Maximum="1024" Minimum="0" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                    <TextBlock
                                        Grid.Column="2"
                                        Margin="5,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="PX" />
                                    <TextBlock
                                        Grid.Column="3"
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="DPI:" />
                                    <TextBox Grid.Column="4" Margin="5,0">
                                        <TextBox.Text>
                                            <Binding
                                                NotifyOnValidationError="True"
                                                Path="TargetDpi"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnExceptions="True">
                                                <Binding.ValidationRules>
                                                    <utils:IntRangeValidationRule Maximum="1024" Minimum="0" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </TextBox.Text>
                                    </TextBox>
                                </Grid>

                                <TextBlock Margin="0,10,0,0" Text="质量" />
                                <ComboBox
                                    Margin="10,5,0,0"
                                    VerticalAlignment="Center"
                                    ItemsSource="{Binding CornerQualityOptions}"
                                    SelectedItem="{Binding SelectedCornerQuality}">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource CornerQualityConverter}}" />
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>

                            </StackPanel>
                        </Border>

                        <Separator Margin="0,0,0,10" />

                        <!--  ICO分辨率设置 - 使用Card样式  -->
                        <Border Margin="0,0,0,10" Padding="16">
                            <StackPanel>
                                <TextBlock Margin="0,0,0,10" Text="ICO分辨率" />
                                <ListBox
                                    MaxHeight="200"
                                    ItemsSource="{Binding AvailableResolutions}"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="models:IcoResolution">
                                            <CheckBox
                                                Margin="2"
                                                Content="{Binding DisplayText}"
                                                IsChecked="{Binding IsSelected}" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </StackPanel>
                        </Border>
                        <Separator Margin="0,0,0,10" />
                        <!--  操作按钮  -->
                        <WrapPanel Margin="0,0,0,10" HorizontalAlignment="Center">
                            <Button
                                Width="80"
                                Height="30"
                                Margin="0,0,10,10"
                                Click="SelectAllResolutions_Click"
                                Content="全选" />
                            <Button
                                Width="80"
                                Height="30"
                                Margin="0,0,0,10"
                                Click="ClearAllResolutions_Click"
                                Content="清空" />

                        </WrapPanel>
                    </StackPanel>
                </ScrollViewer>

            </Grid>

            <!--  日志区域  -->
            <Border Grid.Row="1" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Margin="5,0,0,0"
                        VerticalAlignment="Center"
                        FontSize="16"
                        Text="操作日志" />
                    <Button
                        Grid.Row="0"
                        Height="30"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Command="{Binding ClearLogCommand}"
                        Content="清空日志"
                        Visibility="Collapsed" />
                    <TextBox
                        Grid.Row="1"
                        Padding="5"
                        VerticalContentAlignment="Top"
                        IsReadOnly="True"
                        Text="{Binding LogText}"
                        TextChanged="LogTextBox_TextChanged"
                        VerticalScrollBarVisibility="Auto" />

                </Grid>
            </Border>
            <!--  状态栏  -->
            <Border
                Grid.Row="2"
                Margin="0"
                Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>

                    <StackPanel
                        Grid.Column="0"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <Path
                            Data="{StaticResource Info16}"
                            Fill="{DynamicResource PrimaryTextBrush}"
                            Stretch="Uniform" />
                        <TextBlock
                            Margin="5,0,0,0"
                            VerticalAlignment="Center"
                            Text="{Binding StatusMessage}" />
                    </StackPanel>

                    <ProgressBar
                        Grid.Column="1"
                        Margin="20,0"
                        IsIndeterminate="{Binding IsProcessing}"
                        Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </Grid>
            </Border>
        </Grid>
    </Border>
</hc:Window>
